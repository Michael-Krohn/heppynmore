[Analysis]
tag = 8TeV
TrainFlag = True
###########################################################################################

[Plot_general]
#In Use:
samples: Zudsg,Zudsg5070,Zudsg70100,Zudsg100,Zcc,Zcc5070,Zcc70100,Zcc100,Zbb,Zbb5070,Zbb70100,Zbb100,ZZ,WW,WZ,TT,ST_s,ST_t,ST_tW,STbar_s,STbar_t,STbar_tW,ZH125 

#Groups for adding samples together
Group: {'ZH110':'ZH','ZH115':'ZH','ZH120':'ZH','ZH125':'ZH','ZH130':'ZH','ZH135':'ZH', 'Zudsg':'DYlight','Zudsg5070':'DYlight','Zudsg70100':'DYlight','Zudsg100':'DYlight','Zcc':'DYc','Zcc5070':'DYc','Zcc70100':'DYc','Zcc100':'DYc','Zbb':'DYb','Zbb5070':'DYb','Zbb70100':'DYb','Zbb100':'DYb','ZZ-light':'VV','WW':'VV','WZ':'VV','ZZ':'VV','TT':'TT','ST_s':'ST','ST_t':'ST','ST_tW':'ST','STbar_s':'ST','STbar_t':'ST','STbar_tW':'ST','Zee':'Data','Zmm':'Data','ZZ-bb':'VV'}


#how and which groups in the plot
setup: DYlight,DYc,DYb,TT,ST,VV,ZH

#colors
colorDict: {'DYlight':401,'DYc':41,'DYb':5,'TT':596,'ST':602,'VV':17,'ZH':2}

#To be processed
List: RTight,RMed,Light_RTight,bb_RTight,Top_RTight,Light_RMed,bb_RMed,Top_RMed
# RTight,RMed #,Light

#var definition
BDT_vars: Hmass,Hpt,Vpt,HVdPhi,Vmass,HdR,csv0,csv1,AK7,Sum
BDTs: BDT_RTight,BDT_RMed

[Plot:RTight]
Datas: Zee Zmm
Normalize: False
vars: <!Plot_general|BDTs!>
Signal: ZH125
log: True
blind: True

[Plot:RMed]
Datas: Zee Zmm
Normalize: False
vars: <!Plot_general|BDTs!>
Signal: ZH125
log: True
blind: True

[Plot:Light_RTight]
Datas: Zee Zmm
Normalize: True
vars: <!Plot_general|BDTs!>,<!Plot_general|BDT_vars!>
#vars: BDT_RTight
Signal: ZH125
log: False
blind: False

[Plot:Top_RTight]
Datas: Zee Zmm
Normalize: True
vars: <!Plot_general|BDTs!>,<!Plot_general|BDT_vars!>
#vars: <!Plot_general|BDT_vars!>
Signal: ZH125
log: False
blind: False

[Plot:bb_RTight]
Datas: Zee Zmm
Normalize: True
#vars: <!Plot_general|BDT_vars!>
vars: <!Plot_general|BDTs!>,<!Plot_general|BDT_vars!>
Signal: ZH125
log: False
blind: False

[Plot:Light_RMed]
Datas: Zee Zmm
Normalize: True
#vars: <!Plot_general|BDT_vars!>
vars: <!Plot_general|BDTs!>,<!Plot_general|BDT_vars!>
Signal: ZH125
log: False
blind: False

[Plot:Top_RMed]
Datas: Zee Zmm
Normalize: True
#vars: <!Plot_general|BDT_vars!>
vars: <!Plot_general|BDTs!>,<!Plot_general|BDT_vars!>
Signal: ZH125
log: False
blind: False

[Plot:bb_RMed]
Datas: Zee Zmm
Normalize: True
#vars: <!Plot_general|BDT_vars!>
vars: <!Plot_general|BDTs!>,<!Plot_general|BDT_vars!>
Signal: ZH125
log: False
blind: False


###########################################################################################
# REGRESSION
[Regression]
regWeight = ../data/MVA_BDT_REG_Sept28.weights.xml
regDict = {"Jet_pt": "hJet_pt", "Jet_eta": "hJet_eta", "Jet_e": "hJet_e", "Jet_ptRaw": "hJet_ptRaw","Jet_cef": "hJet_cef", "Jet_chf": "hJet_chf","Jet_nconstituents": "hJet_nconstituents","Jet_ptLeadTrack": "hJet_ptLeadTrack", "Jet_vtxPt": "hJet_vtxPt", "Jet_vtxMass": "hJet_vtxMass", "Jet_vtx3dL": "hJet_vtx3dL", "Jet_vtx3deL": "hJet_vtx3deL","Jet_SoftLeptptRel":"hJet_SoftLeptptRel","Jet_SoftLeptPt":"hJet_SoftLeptPt","Jet_SoftLeptdR":"hJet_SoftLeptdR"}
regVars = ["Jet_pt","Jet_eta","Jet_e","Jet_ptRaw","Jet_cef","Jet_chf","Jet_nconstituents","Jet_ptLeadTrack","Jet_vtxPt","Jet_vtxMass","Jet_vtx3dL", "Jet_vtx3deL","Jet_SoftLeptptRel","Jet_SoftLeptPt","Jet_SoftLeptdR"]
useMET = True
usePtRaw = True
useMt = True
useRho25 = True

[BTagReshaping]
library=<!Directories|vhbbpath!>/interface/BTagReshaping_h.so

###########################################################################################
# LIMIT
[LimitGeneral]
varName = CMS_vhbb_BDT_Zll
range = BDT output,20,-1,1

systematicsnaming7TeV={'JER':'CMS_res_j','JES':'CMS_scale_j','beff':'CMS_eff_b','bmis':'CMS_fake_b_7TeV'}
systematicsnaming8TeV={'JER':'CMS_res_j','JES':'CMS_scale_j','beff':'CMS_eff_b','bmis':'CMS_fake_b_8TeV'}

sys_BDT: ['JER','JES','beff','bmis']
sys_Mjj: ['JER','JES']


#Add a different Cut (syntax: 'oldVar>newVar?' -> '?' will then automatically be replaced with 'Up'/'Down' for the variations)

#sys_cut_suffix: {'JER':'nominal','JES':'nominal','beff':'csv>csv?','bmis':'csv>csvF?'}
sys_cut_suffix: {'JER':'nominal','JES':'nominal','beff':'nominal','bmis':'nominal'}

weightF_sys: False

#Example of sample systematic, in this case the ZZ sample is replaced by WZ
#addSample_sys: {'ZZ':'WZ'}

# bin-by-bin statistics
binstat: True


blind: True
#### rescaling by factor 4
scaling: True
#rescale stats
rescaleSqrtN: False

BKG = ['Zudsg','Zudsg5070','Zudsg70100','Zudsg100','Zcc','Zcc5070','Zcc70100','Zcc100','Zbb','Zbb5070','Zbb70100','Zbb100','ZZ','WW','WZ','TT','ST_s','ST_t','ST_tW','STbar_s','STbar_t','STbar_tW']

#Groups for adding samples together
Group: {'ZH110':'ZH','ZH115':'ZH','ZH120':'ZH','ZH125':'ZH','ZH130':'ZH','ZH135':'ZH', 'Zudsg':'DYlight','Zudsg5070':'DYlight','Zudsg70100':'DYlight','Zudsg100':'DYlight','Zcc':'DYlight','Zcc5070':'DYlight','Zcc70100':'DYlight','Zcc100':'DYlight','Zbb':'DYb','Zbb5070':'DYb','Zbb70100':'DYb','Zbb100':'DYb','ZZ-light':'VV','WW':'VV','WZ':'VV','ZZ':'VV','TT':'TT','ST_s':'ST','ST_t':'ST','ST_tW':'ST','STbar_s':'ST','STbar_t':'ST','STbar_tW':'ST','Zee':'Data','Zmm':'Data','ZZ-bb':'VV'}
#naming for DC
Dict: {'ZH':'VH','DYlight':'ZjLF','DYb':'ZjHF','TT':'TT','ST':'s_Top','VV':'VV','ZZ-bb':'ZZbb','Data':'data_obs'}

#SETUP DATACARD (1st Signal, afterwards BKG)
setup: ['ZH', 'DYlight','DYb','VV','TT','ST']


[Datacard]

InUse: ['lumi_8TeV','pdf_qqbar','pdf_gg','QCDscale_VH','QCDscale_ttbar','QCDscale_VV','QCDscale_QCD','CMS_vhbb_boost_EWK','CMS_vhbb_boost_QCD','CMS_vhbb_ST','CMS_vhbb_VV','CMS_vhbb_ZjLF_ex','CMS_vhbb_ZjHF_ex','CMS_vhbb_TT_ex','CMS_eff_e','CMS_eff_m','CMS_trigger_e','CMS_trigger_m','CMS_vhbb_trigger_MET','CMS_vhbb_ZjLF_SF_8TeV','CMS_vhbb_ZjHF_SF_8TeV','CMS_vhbb_TT_SF_8TeV']

lumi_7TeV: {'type':'lnN', 'ZH':1.022,'ST':1.022,'VV':1.022}

lumi_8TeV: {'type':'lnN', 'ZH':1.05,'ST':1.05,'VV':1.05}

pdf_qqbar: {'type':'lnN', 'ZH':1.01,'VV':1.01}
pdf_gg: {'type':'lnN', 'ST':1.01,'QCD':1.01}
QCDscale_VH: {'type':'lnN', 'ZH':1.04}
QCDscale_ttbar: {'type':'lnN', 'ST':1.06}
QCDscale_VV: {'type':'lnN', 'VV':1.04} 
QCDscale_QCD: {'type':'lnN', 'QCD':1.30}
CMS_vhbb_boost_EWK: {'type':'lnN', 'ZH':1.05}
CMS_vhbb_boost_QCD: {'type':'lnN', 'ZH':1.10}
CMS_vhbb_ST: {'type':'lnN', 'ST':1.29}
CMS_vhbb_VV: {'type':'lnN', 'VV':1.30}
CMS_vhbb_ZjLF_ex: {'type':'lnN', 'DYlight':1.05}
CMS_vhbb_ZjHF_ex: {'type':'lnN', 'DYb':1.05}
CMS_vhbb_TT_ex: {'type':'lnN', 'TT':1.05}
CMS_vhbb_ZjLF_ex_8TeV: {'type':'lnN', 'DYlight':1.05}
CMS_vhbb_ZjHF_ex_8TeV: {'type':'lnN', 'DYb':1.05}
CMS_vhbb_TT_ex_8TeV: {'type':'lnN', 'TT':1.05}
CMS_eff_e: {'type':'lnN', 'ZH':1.04, 'ST':1.04,'VV':1.04,'QCD':1.04}
CMS_trigger_e: {'type':'lnN','ZH':1.02, 'ST':1.02,'VV':1.02 }
CMS_eff_m: {'type':'lnN',  'ZH':1.04, 'ST':1.04,'VV':1.04,'QCD':1.04}
CMS_trigger_m: {'type':'lnN', 'ZH':1.01, 'ST':1.01,'VV':1.01 }
CMS_vhbb_trigger_MET: {'type':'lnN'}

CMS_vhbb_ZjLF_SF_7TeV: {'type':'lnN', 'DYlight':1.198 ,'DYb':0.875 ,'TT':1.003}
CMS_vhbb_ZjHF_SF_7TeV: {'type':'lnN', 'DYlight':0.873 ,'DYb':1.202 ,'TT':0.957}
CMS_vhbb_TT_SF_7TeV: {'type':'lnN',  'DYlight':1.002 ,'DYb':0.974 ,'TT':1.123}

CMS_vhbb_ZjLF_SF_8TeV: {'type':'lnN', 'DYlight':1.040 ,'DYb':0.974 ,'TT':1.001}
CMS_vhbb_ZjHF_SF_8TeV: {'type':'lnN', 'DYlight':0.897 ,'DYb':1.162 ,'TT':0.966}
CMS_vhbb_TT_SF_8TeV: {'type':'lnN',  'DYlight':1.002 ,'DYb':0.983 ,'TT':1.079}



[Limit]

#Mjj low EE
Mjj_lowPt_ZH110_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M110_Zee,Mjj_lowPt_EE,Mjj_lowPt_EE,ZH110,Zee,Mjj
Mjj_lowPt_ZH115_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M115_Zee,Mjj_lowPt_EE,Mjj_lowPt_EE,ZH115,Zee,Mjj
Mjj_lowPt_ZH120_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M120_Zee,Mjj_lowPt_EE,Mjj_lowPt_EE,ZH120,Zee,Mjj
Mjj_lowPt_ZH125_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M125_Zee,Mjj_lowPt_EE,Mjj_lowPt_EE,ZH125,Zee,Mjj
Mjj_lowPt_ZH130_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M130_Zee,Mjj_lowPt_EE,Mjj_lowPt_EE,ZH130,Zee,Mjj
Mjj_lowPt_ZH135_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M135_Zee,Mjj_lowPt_EE,Mjj_lowPt_EE,ZH135,Zee,Mjj

#Mjj low MM
Mjj_lowPt_ZH110_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M110_Zmm,Mjj_lowPt_MM,Mjj_lowPt_MM,ZH110,Zmm,Mjj
Mjj_lowPt_ZH115_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M115_Zmm,Mjj_lowPt_MM,Mjj_lowPt_MM,ZH115,Zmm,Mjj
Mjj_lowPt_ZH120_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M120_Zmm,Mjj_lowPt_MM,Mjj_lowPt_MM,ZH120,Zmm,Mjj
Mjj_lowPt_ZH125_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M125_Zmm,Mjj_lowPt_MM,Mjj_lowPt_MM,ZH125,Zmm,Mjj
Mjj_lowPt_ZH130_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M130_Zmm,Mjj_lowPt_MM,Mjj_lowPt_MM,ZH130,Zmm,Mjj
Mjj_lowPt_ZH135_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_lowPt_M135_Zmm,Mjj_lowPt_MM,Mjj_lowPt_MM,ZH135,Zmm,Mjj

#Mjj high EE
Mjj_highPt_ZH110_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M110_Zee,Mjj_highPt_EE,Mjj_highPt_EE,ZH110,Zee,Mjj
Mjj_highPt_ZH115_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M115_Zee,Mjj_highPt_EE,Mjj_highPt_EE,ZH115,Zee,Mjj
Mjj_highPt_ZH120_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M120_Zee,Mjj_highPt_EE,Mjj_highPt_EE,ZH120,Zee,Mjj
Mjj_highPt_ZH125_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M125_Zee,Mjj_highPt_EE,Mjj_highPt_EE,ZH125,Zee,Mjj
Mjj_highPt_ZH130_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M130_Zee,Mjj_highPt_EE,Mjj_highPt_EE,ZH130,Zee,Mjj
Mjj_highPt_ZH135_EE: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M135_Zee,Mjj_highPt_EE,Mjj_highPt_EE,ZH135,Zee,Mjj

#Mjj high MM
Mjj_highPt_ZH110_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M110_Zmm,Mjj_highPt_MM,Mjj_highPt_MM,ZH110,Zmm,Mjj
Mjj_highPt_ZH115_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M115_Zmm,Mjj_highPt_MM,Mjj_highPt_MM,ZH115,Zmm,Mjj
Mjj_highPt_ZH120_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M120_Zmm,Mjj_highPt_MM,Mjj_highPt_MM,ZH120,Zmm,Mjj
Mjj_highPt_ZH125_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M125_Zmm,Mjj_highPt_MM,Mjj_highPt_MM,ZH125,Zmm,Mjj
Mjj_highPt_ZH130_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M130_Zmm,Mjj_highPt_MM,Mjj_highPt_MM,ZH130,Zmm,Mjj
Mjj_highPt_ZH135_MM: H.mass,Mjj,Mjj,25,0.,250.,Mjj_highPt_M135_Zmm,Mjj_highPt_MM,Mjj_highPt_MM,ZH135,Zmm,Mjj

#Tight EE
RTight_ZH110_EE_8TeV: RTight_ZH110_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M110_ZeeHighPt_8TeV,RTight_EE,RTight_EE,ZH110,ZeeHighPt_8TeV,BDT
RTight_ZH115_EE_8TeV: RTight_ZH115_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M115_ZeeHighPt_8TeV,RTight_EE,RTight_EE,ZH115,ZeeHighPt_8TeV,BDT
RTight_ZH120_EE_8TeV: RTight_ZH120_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M120_ZeeHighPt_8TeV,RTight_EE,RTight_EE,ZH120,ZeeHighPt_8TeV,BDT
RTight_ZH125_EE_8TeV: RTight_ZH125_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M125_ZeeHighPt_8TeV,RTight_EE,RTight_EE,ZH125,ZeeHighPt_8TeV,BDT
RTight_ZH130_EE_8TeV: RTight_ZH130_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M130_ZeeHighPt_8TeV,RTight_EE,RTight_EE,ZH130,ZeeHighPt_8TeV,BDT
RTight_ZH135_EE_8TeV: RTight_ZH135_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M135_ZeeHighPt_8TeV,RTight_EE,RTight_EE,ZH135,ZeeHighPt_8TeV,BDT

#Tight MM
RTight_ZH110_MM_8TeV: RTight_ZH110_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M110_ZmmHighPt_8TeV,RTight_MM,RTight_MM,ZH110,ZmmHighPt_8TeV,BDT
RTight_ZH115_MM_8TeV: RTight_ZH115_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M115_ZmmHighPt_8TeV,RTight_MM,RTight_MM,ZH115,ZmmHighPt_8TeV,BDT
RTight_ZH120_MM_8TeV: RTight_ZH120_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M120_ZmmHighPt_8TeV,RTight_MM,RTight_MM,ZH120,ZmmHighPt_8TeV,BDT
RTight_ZH125_MM_8TeV: RTight_ZH125_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M125_ZmmHighPt_8TeV,RTight_MM,RTight_MM,ZH125,ZmmHighPt_8TeV,BDT
RTight_ZH130_MM_8TeV: RTight_ZH130_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M130_ZmmHighPt_8TeV,RTight_MM,RTight_MM,ZH130,ZmmHighPt_8TeV,BDT
RTight_ZH135_MM_8TeV: RTight_ZH135_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M135_ZmmHighPt_8TeV,RTight_MM,RTight_MM,ZH135,ZmmHighPt_8TeV,BDT

#Med EE
RMed_ZH110_EE_8TeV: RMed_ZH110_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M110_ZeeLowPt_8TeV,RMed_EE,RMed_EE,ZH110,ZeeLowPt_8TeV,BDT
RMed_ZH115_EE_8TeV: RMed_ZH115_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M115_ZeeLowPt_8TeV,RMed_EE,RMed_EE,ZH115,ZeeLowPt_8TeV,BDT
RMed_ZH120_EE_8TeV: RMed_ZH120_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M120_ZeeLowPt_8TeV,RMed_EE,RMed_EE,ZH120,ZeeLowPt_8TeV,BDT
RMed_ZH125_EE_8TeV: RMed_ZH125_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M125_ZeeLowPt_8TeV,RMed_EE,RMed_EE,ZH125,ZeeLowPt_8TeV,BDT
RMed_ZH130_EE_8TeV: RMed_ZH130_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M130_ZeeLowPt_8TeV,RMed_EE,RMed_EE,ZH130,ZeeLowPt_8TeV,BDT
RMed_ZH135_EE_8TeV: RMed_ZH135_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M135_ZeeLowPt_8TeV,RMed_EE,RMed_EE,ZH135,ZeeLowPt_8TeV,BDT

#Med MM
RMed_ZH110_MM_8TeV: RMed_ZH110_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M110_ZmmLowPt_8TeV,RMed_MM,RMed_MM,ZH110,ZmmLowPt_8TeV,BDT
RMed_ZH115_MM_8TeV: RMed_ZH115_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M115_ZmmLowPt_8TeV,RMed_MM,RMed_MM,ZH115,ZmmLowPt_8TeV,BDT
RMed_ZH120_MM_8TeV: RMed_ZH120_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M120_ZmmLowPt_8TeV,RMed_MM,RMed_MM,ZH120,ZmmLowPt_8TeV,BDT
RMed_ZH125_MM_8TeV: RMed_ZH125_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M125_ZmmLowPt_8TeV,RMed_MM,RMed_MM,ZH125,ZmmLowPt_8TeV,BDT
RMed_ZH130_MM_8TeV: RMed_ZH130_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M130_ZmmLowPt_8TeV,RMed_MM,RMed_MM,ZH130,ZmmLowPt_8TeV,BDT
RMed_ZH135_MM_8TeV: RMed_ZH135_may_4.nominal,CMS_vhbb_BDT_Zll_8TeV,BDT output,10,-1,1,BDT_M135_ZmmLowPt_8TeV,RMed_MM,RMed_MM,ZH135,ZmmLowPt_8TeV,BDT

#GENERAL SETUP LIMIT:
setup: DYlight+DYc,DYb,TT,VV,ST,ZH
blind: False


##############################################################################################
# MVA definitions
[MVAGeneral]
type = BDT
SettingsTight = !H:!V:NTrees=400:nEventsMin=500:MaxDepth=3:BoostType=AdaBoost:AdaBoostBeta=0.1:SeparationType=MisClassificationError:nCuts=25:PruneMethod=NoPruning
SettingsMed = !H:!V:NTrees=400:nEventsMin=300:MaxDepth=2:BoostType=AdaBoost:AdaBoostBeta=0.12:SeparationType=MisClassificationError:nCuts=25:PruneMethod=NoPruning
backgrounds = Zudsg Zudsg_pt120 Zbb Zbb_pt120 Zcc Zcc_pt120 WZ ZZ TT
backgroundsNoDiboson = Zudsg Zudsg_pt120 Zbb Zbb_pt120 Zcc Zcc_pt120 TT

backgrounds8TeV: Zudsg Zudsg5070 Zudsg70100 Zudsg100 Zcc Zcc5070 Zcc70100 Zcc100 Zbb Zbb5070 Zbb70100 Zbb100 ZZ WW WZ TT 

[factory]
factoryname: MVA
factorysettings: !V:!Silent:Color:DrawProgressBar:AnalysisType=Classification:Transformations=I
#:Transformations=I;D;P;G,D

[MVALists]
#List_for_submitscript: RTight_ZH110,RTight_ZH115,RTight_ZH120,RTight_ZH125,RTight_ZH130,RTight_ZH135,RMed_ZH110,RMed_ZH115,RMed_ZH120,RMed_ZH125,RMed_ZH130,RMed_ZH135
#List_for_submitscript: RTight_ZH110_may,RTight_ZH115_may,RTight_ZH120_may,RTight_ZH125_may,RTight_ZH130_may,RTight_ZH135_may,RMed_ZH110_may,RMed_ZH115_may,RMed_ZH120_may,RMed_ZH125_may,RMed_ZH130_may,RMed_ZH135_may,RPt50_ZZ_may,RIncl_ZZ_may
List_for_submitscript: RTight_ZH110_may,RTight_ZH115_may,RTight_ZH120_may,RTight_ZH125_may,RTight_ZH130_may,RTight_ZH135_may,RMed_ZH110_may,RMed_ZH115_may,RMed_ZH120_may,RMed_ZH125_may,RMed_ZH130_may,RMed_ZH135_may

[RTight_ZZ_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>
signals: ZZ
backgrounds: <!MVAGeneral|backgroundsNoDiboson!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RTight_ZH110_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>
signals: ZH110
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RTight_ZH115_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>
signals: ZH115
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RTight_ZH120_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>
signals: ZH120
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RTight_ZH125_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>
signals: ZH125
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RTight_ZH125_oct]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>/env/sys/
signals: ZH125
backgrounds: <!MVAGeneral|backgrounds8TeV!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RTight_ZH130_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>
signals: ZH130
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RTight_ZH135_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsTight!>
path: <!Directories|samplepath!>
signals: ZH135
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RTight

[RMed_ZH110_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsMed!>
path: <!Directories|samplepath!>
signals: ZH110
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RMed

[RMed_ZH115_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsMed!>
path: <!Directories|samplepath!>
signals: ZH115
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RMed

[RMed_ZH120_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsMed!>
path: <!Directories|samplepath!>
signals: ZH120
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RMed

[RMed_ZH125_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsMed!>
path: <!Directories|samplepath!>
signals: ZH125
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RMed

[RMed_ZH130_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsMed!>
path: <!Directories|samplepath!>
signals: ZH130
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RMed

[RMed_ZH135_may]
MVAtype: <!MVAGeneral|type!>
MVAsettings: <!MVAGeneral|SettingsMed!>
path: <!Directories|samplepath!>
signals: ZH135
backgrounds: <!MVAGeneral|backgrounds!>
treeVarSet: treeVarsICHEP
treeCut: RMed


##############################################################################################
# SYSTEMATICS:

[systematics]
systematics: Nominal JER_up JER_down JES_up JES_down beff_up beff_down bmis_up bmis_down


[treeVarsICHEP]
Nominal: H.mass H.pt HVdPhi V.mass V.pt H.dEta max(hJet_csv[0],hJet_csv[1]) min(hJet_csv[0],hJet_csv[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt[0] hJet_pt[1] deltaPullAngle deltaPullAngle2
JER_up: H_JER.mass_up H_JER.pt_up HVdPhi V.mass V.pt H.dEta max(hJet_csv[0],hJet_csv[1]) min(hJet_csv[0],hJet_csv[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt_JER_up[0] hJet_pt_JER_up[1] deltaPullAngle deltaPullAngle2
JER_down: H_JER.mass_down H_JER.pt_down HVdPhi V.mass V.pt H.dEta max(hJet_csv[0],hJet_csv[1]) min(hJet_csv[0],hJet_csv[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt_JER_down[0] hJet_pt_JER_down[1] deltaPullAngle deltaPullAngle2
JES_up: H_JES.mass_up H_JES.pt_up HVdPhi V.mass V.pt H.dEta max(hJet_csv[0],hJet_csv[1]) min(hJet_csv[0],hJet_csv[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt_JES_up[0] hJet_pt_JES_up[1] deltaPullAngle deltaPullAngle2
JES_down: H_JES.mass_down H_JES.pt_down HVdPhi V.mass V.pt H.dEta max(hJet_csv[0],hJet_csv[1]) min(hJet_csv[0],hJet_csv[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt_JES_down[0] hJet_pt_JES_down[1] deltaPullAngle deltaPullAngle2
beff_up: H.mass H.pt HVdPhi V.mass V.pt H.dEta max(hJet_csvUp[0],hJet_csvUp[1]) min(hJet_csvUp[0],hJet_csvUp[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt[0] hJet_pt[1] deltaPullAngle deltaPullAngle2
beff_down: H.mass H.pt HVdPhi V.mass V.pt H.dEta max(hJet_csvDown[0],hJet_csvDown[1]) min(hJet_csvDown[0],hJet_csvDown[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt[0] hJet_pt[1] deltaPullAngle deltaPullAngle2
bmis_up: H.mass H.pt HVdPhi V.mass V.pt H.dEta max(hJet_csvFUp[0],hJet_csvFUp[1]) min(hJet_csvFUp[0],hJet_csvFUp[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt[0] hJet_pt[1] deltaPullAngle deltaPullAngle2
bmis_down: H.mass H.pt HVdPhi V.mass V.pt H.dEta max(hJet_csvFDown[0],hJet_csvFDown[1]) min(hJet_csvFDown[0],hJet_csvFDown[1]) Sum$(aJet_pt>20.&abs(aJet_eta)<2.4) H.dR hJet_pt[0] hJet_pt[1] deltaPullAngle deltaPullAngle2


#############################################################################################
# TreeCuts:
[ZHbb]
CSVT = 0.898
CSVC = 0.5
CSVL = 0.244
minBtag = min(hJet_csv[0],hJet_csv[1])
maxBtag = max(hJet_csv[0],hJet_csv[1])
tlBtag = <!ZHbb|maxBtag!> > <!ZHbb|CSVT!> & <!ZHbb|minBtag!> > <!ZHbb|CSVC!>
ntBtag = !(hJet_csv[0] > <!ZHbb|CSVT!> | hJet_csv[1] > <!ZHbb|CSVT!>)
twoCSV0 = hJet_csv[0] > 0. & hJet_csv[1] > 0. 
preselection = hJet_pt[0] > 30. & hJet_pt[1] > 30. & abs(hJet_eta[0]) < 2.4 & abs(hJet_eta[1]) < 2.4 & hbhe & hJet_puJetIdL[0] > 0. & hJet_puJetIdL[1] > 0.
zWindow = V.mass > 75. & V.mass < 105
zVeto =  (V.mass > 105 | V.mass < 75.)
noAddJet = Sum$(aJet_pt > 20 & abs(aJet_eta) < 2.4) == 0 
max1AddJet = Sum$(aJet_pt > 20 & abs(aJet_eta) < 2.4) < 2.
vetoHMass = (H.mass < 90. | H.mass > 145.)
pullAngle = deltaPullAngle < 10. & deltaPullAngle2 < 10.
rTight = V.pt > 100.
rMed = V.pt > 50. & V.pt < 100.
upperHMass = H.mass < 250.
looseHMass = H.mass > 80. & H.mass < 150.
dPhiVH = abs( HVdPhi ) > 2.9 
looseBTag = !(hJet_csv[0] > <!ZHbb|CSVL!> & hJet_csv[1] > <!ZHbb|CSVL!>) & (hJet_csv[0] > <!ZHbb|CSVL!> | hJet_csv[1] > <!ZHbb|CSVL!>)

[ZHeebb]
addCuts = Vtype==1 & (triggerFlags[5]>0 || triggerFlags[6]>0)

[ZHmmbb]
addCuts = Vtype==0 & (triggerFlags[14]>0 || triggerFlags[21]>0 || triggerFlags[22]>0 || triggerFlags[23]>0)

[Cuts]
mjjLowPt = <!ZHbb|preselection!> & <!ZHbb|rMed!> & <!ZHbb|tlBtag!> & <!ZHbb|zWindow!> & <!ZHbb|max1AddJet!> & <!ZHbb|upperHMass!> & <!ZHbb|dPhiVH!>
mjjHighPt = <!ZHbb|preselection!> & <!ZHbb|rTight!> & <!ZHbb|tlBtag!> & <!ZHbb|zWindow!> & <!ZHbb|max1AddJet!> & <!ZHbb|upperHMass!> & <!ZHbb|dPhiVH!>

#V.pt regions:
RMed = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVC!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rMed!> & <!ZHbb|looseHMass!> &  RMed_ZH125_may_4.nominal >= -0.6
RTight = <!ZHbb|preselection!> & <!ZHbb|maxBtag!> > <!ZHbb|CSVL!> & <!ZHbb|minBtag!> > <!ZHbb|CSVL!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|upperHMass!> 
RTightLooseBTag = <!ZHbb|preselection!> & <!ZHbb|zWindow!> & <!ZHbb|pullAngle!> & <!ZHbb|rTight!> & <!ZHbb|upperHMass!> & <!ZHbb|looseBTag!>

#control regions
Light: <!ZHbb|preselection!> & <!ZHbb|noAddJet!> & <!ZHbb|zWindow!> & <!ZHbb|ntBtag!> & <!ZHbb|upperHMass!> & <!ZHbb|twoCSV0!> & <!ZHbb|dPhiVH!>
Top = <!ZHbb|preselection!> & <!ZHbb|upperHMass!> & <!ZHbb|tlBtag!> & <!ZHbb|zVeto!> & H.pt > 100.
bb = <!ZHbb|preselection!> & <!ZHbb|vetoHMass!> & <!ZHbb|upperHMass!> & <!ZHbb|zWindow!> & <!ZHbb|tlBtag!> & <!ZHbb|max1AddJet!> & <!ZHbb|dPhiVH!>

Light_RTight = <!Cuts|Light!> & <!ZHbb|rTight!>
Top_RTight = <!Cuts|Top!> & <!ZHbb|rTight!>
bb_RTight = <!Cuts|bb!> & <!ZHbb|rTight!>

Light_RMed = <!Cuts|Light!> & <!ZHbb|rMed!>
Top_RMed = <!Cuts|Top!> & <!ZHbb|rMed!>
bb_RMed = <!Cuts|bb!> & <!ZHbb|rMed!>

triggerEE = (triggerFlags[5]>0 || triggerFlags[6]>0)
triggerMM = (triggerFlags[14]>0 || triggerFlags[21]>0 || triggerFlags[22]>0 || triggerFlags[23]>0) 
#lepton individual
RTight_EE: Vtype==1  & <!Cuts|RTight!>
RTight_MM: Vtype==0 & <!Cuts|RTight!>
RMed_EE: Vtype==1 & <!Cuts|RMed!>
RMed_MM: Vtype==0 & <!Cuts|RMed!>
RTightLooseBTag_EE: Vtype==1 & <!Cuts|RTightLooseBTag!>
RTightLooseBTag_MM: Vtype==0 & <!Cuts|RTightLooseBTag!>

#Mjj
Mjj_lowPt_EE: <!ZHeebb|addCuts!> & <!Cuts|mjjLowPt!> 
Mjj_lowPt_MM: <!ZHmmbb|addCuts!> & <!Cuts|mjjLowPt!> 

Mjj_highPt_EE: <!ZHeebb|addCuts!> & <!Cuts|mjjHighPt!>
Mjj_highPt_MM: <!ZHmmbb|addCuts!> & <!Cuts|mjjHighPt!> 

###########################################################################################
# other things:

[Weights]
weightF: (PUweight*weightTrig2012A)

# LocalWords:  Mjj
